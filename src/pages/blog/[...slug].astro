---
import { getGitInfo } from "@/lib/git";
import { getCollection } from "astro:content";
import BlogLayout from "@/layouts/blog-layout.astro";

export async function getStaticPaths() {
  const blogs = await getCollection('blog');
  const blogsWithGitInfo = await Promise.all(
    blogs.map(async (post) => {
      const gitInfo = await getGitInfo(post.slug);
      if(gitInfo === null) {
        return post;
      } else {
        return { ...post, ...gitInfo }
      }
    })
  );

  return blogsWithGitInfo.map((post) => ({
    params: { slug: post.slug },
    props: post,
  }));
}

const post = Astro.props;
const { Content } = await post.render();
---
<BlogLayout title={post.data.title} description={post.data.description}>
  <Content />
</BlogLayout>
